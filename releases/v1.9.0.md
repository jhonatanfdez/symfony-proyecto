# Release v1.9.0 - Sistema de Im√°genes M√∫ltiples para Productos

**Fecha**: 25 de octubre de 2025

## üéØ Resumen

Esta versi√≥n introduce la **infraestructura completa para gestionar m√∫ltiples im√°genes por producto**, preparando el terreno para cargar, visualizar en carousel y eliminar im√°genes de forma individual.

---

## ‚ú® Nuevas Caracter√≠sticas

### üì∏ Sistema de Im√°genes M√∫ltiples

- **Entidad ProductImage**: Nueva entidad para almacenar metadatos de im√°genes
  - Campos: `imageName`, `imagePath`, `position`, `createdAt`
  - Relaci√≥n ManyToOne con `Product`
  
- **Relaci√≥n OneToMany en Product**: Colecci√≥n de im√°genes por producto
  - M√©todos helper: `addProductImage()`, `removeProductImage()`, `getProductImages()`
  
- **Migraci√≥n de Base de Datos**: Tabla `product_image` con:
  - Foreign key a tabla `product`
  - √çndices optimizados para consultas
  
- **Directorio de Almacenamiento**: `public/uploads/products/`
  - Estructura preparada con `.gitkeep`
  - `.gitignore` configurado para excluir archivos binarios

### üìù Formulario de Carga

- **ProductImageType**: Formulario especializado para carga m√∫ltiple
  - Campo `FileType` con `multiple=true`
  - No vinculado a entidad (`mapped=false`) para procesamiento manual
  - Documentaci√≥n exhaustiva en espa√±ol

### üõ°Ô∏è Validaciones Robustas

- **L√≠mite de im√°genes**: M√°ximo 10 por producto (`Assert\Count`)
- **Tama√±o m√°ximo**: 5MB por imagen
- **Formatos permitidos**: JPEG, PNG, WEBP
- **Doble capa de validaci√≥n**:
  - HTML5 para feedback inmediato
  - Server-side (infranqueable) con Symfony Validator

---

## üîß Cambios T√©cnicos

### Arquitectura de Seguridad

```php
// Validaciones en ProductImageType
'constraints' => [
    new Assert\Count([
        'max' => 10,
        'maxMessage' => 'No puedes subir m√°s de {{ limit }} im√°genes.'
    ]),
    new Assert\All([
        new Assert\Image([
            'maxSize' => '5M',
            'mimeTypes' => ['image/jpeg', 'image/png', 'image/webp'],
            'maxSizeMessage' => 'La imagen no debe superar {{ limit }} {{ suffix }}.',
            'mimeTypesMessage' => 'Por favor sube una imagen v√°lida ({{ types }}).'
        ])
    ])
]
```

### Estructura de Datos

**Entidad ProductImage**:
- `id`: INT (PK)
- `imageName`: VARCHAR(255) - Nombre original del archivo
- `imagePath`: VARCHAR(255) - Ruta relativa desde public/
- `position`: INT nullable - Orden de visualizaci√≥n
- `createdAt`: DATETIME_IMMUTABLE - Timestamp de carga
- `product_id`: FK a `product`

**Relaci√≥n en Product**:
```php
#[ORM\OneToMany(targetEntity: ProductImage::class, mappedBy: 'product', orphanRemoval: true)]
private Collection $productImages;
```

---

## üìÅ Archivos Modificados/Creados

### Nuevos Archivos
- `src/Entity/ProductImage.php` - Entidad de im√°genes
- `src/Repository/ProductImageRepository.php` - Repositorio
- `src/Form/ProductImageType.php` - Formulario de carga
- `migrations/Version20251026020821.php` - Migraci√≥n DB
- `public/uploads/products/.gitkeep` - Directorio de almacenamiento
- `releases/v1.9.0.md` - Esta documentaci√≥n

### Archivos Modificados
- `src/Entity/Product.php` - Agregada colecci√≥n productImages
- `.gitignore` - Exclusi√≥n de uploads
- `CHANGELOG.md` - Entrada v1.9.0

---

## üöÄ Pr√≥ximos Pasos

Esta release establece la **infraestructura base**. Las siguientes caracter√≠sticas a implementar son:

1. **Controlador de Carga**: M√©todo en `ProductController` para procesar archivos
   - Generar nombres √∫nicos: `producto-{id}-{timestamp}-{uniqid()}.{ext}`
   - Mover archivos a `public/uploads/products/`
   - Persistir entidades `ProductImage`

2. **Vista de Producto**: Carousel con Bootstrap 5
   - Visualizaci√≥n de todas las im√°genes
   - Indicadores y controles de navegaci√≥n

3. **Eliminaci√≥n Individual**: Endpoint para borrar una imagen espec√≠fica
   - Eliminar registro de DB
   - Borrar archivo f√≠sico con `unlink()`

4. **Protecci√≥n Adicional**: `.htaccess` en uploads para prevenir ejecuci√≥n de scripts

---

## üìö Documentaci√≥n

Toda la documentaci√≥n del c√≥digo est√° en **espa√±ol** para facilitar el mantenimiento:

- Comentarios PHPDoc en entidades
- Explicaciones de arquitectura en formularios
- Notas de seguridad sobre validaciones
- Gu√≠as de uso en archivos de configuraci√≥n

---

## üîê Seguridad

### Validaciones Implementadas

‚úÖ **Tama√±o de archivo**: M√°ximo 5MB por imagen
‚úÖ **Tipos MIME**: Solo JPEG, PNG, WEBP
‚úÖ **Cantidad**: M√°ximo 10 im√°genes por producto
‚úÖ **Validaci√≥n server-side**: No bypasseable por cliente

### Pendiente de Implementar

- [ ] `.htaccess` en `public/uploads/` para denegar ejecuci√≥n PHP
- [ ] Rate limiting en endpoint de carga (opcional)
- [ ] Optimizaci√≥n/compresi√≥n de im√°genes (opcional)
- [ ] Marca de agua en im√°genes (opcional)

---

## üìä Estad√≠sticas

- **Archivos nuevos**: 6
- **Archivos modificados**: 3
- **L√≠neas de c√≥digo agregadas**: ~315
- **Entidades**: 1 nueva (ProductImage)
- **Migraciones**: 1 nueva
- **Formularios**: 1 nuevo

---

## üôè Notas

Esta es una **release de infraestructura**. La funcionalidad completa (carga, visualizaci√≥n, eliminaci√≥n) se implementar√° en commits posteriores antes de la siguiente versi√≥n.

El enfoque incremental permite:
- ‚úÖ Revisar la arquitectura base antes de proceder
- ‚úÖ Validar el dise√±o de la base de datos
- ‚úÖ Confirmar las validaciones y restricciones
- ‚úÖ Preparar el terreno para una implementaci√≥n s√≥lida

---

**Tag**: `v1.9.0`  
**Commit**: `971f241`  
**Branch**: `main`
