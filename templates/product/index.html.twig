{#
    Template: Listado de Productos (index)

    PROPÓSITO:
    - Muestra tabla con todos los productos del sistema
    - Permite acceso rápido a Ver, Editar y Eliminar cada producto
    - Botón para crear nuevos productos

    DATOS RECIBIDOS:
    - products: Array de objetos Product (desde ProductController::index)

    CARACTERÍSTICAS:
    - Tabla Bootstrap con estilo striped (filas alternadas)
    - Badges de color para estado (Activo/Inactivo)
    - Botones de acción inline con clases Bootstrap
    - Integración con SweetAlert2 para confirmación de eliminación
    - Acceso a relaciones: product.categoria.nombre
#}
{% extends 'home/base.html.twig' %}

{% block title %}Listado de Productos{% endblock %}

{# Ejemplo de uso de breadcrumbs:
{% block breadcrumbs %}
  {% include 'partials/_breadcrumbs.html.twig' with {
    items: [
      { label: 'Productos', active: true }
    ]
  } %}
{% endblock %}
#}

{% block content %}
    {% set cardBody %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Nombre</th>
                    <th>Categoría</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
            {% for product in products %}
                <tr>
                    <td>{{ product.sku }}</td>
                    <td>{{ product.nombre }}</td>
                    <td>{{ product.categoria.nombre }}</td>
                    <td>${{ product.precio }}</td>
                    <td>
                        {% if product.stock > 10 %}
                            <span class="badge bg-success">{{ product.stock }} unidades</span>
                        {% elseif product.stock > 0 %}
                            <span class="badge bg-warning text-dark">{{ product.stock }} unidades</span>
                        {% else %}
                            <span class="badge bg-danger">Sin Stock</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if product.activo %}
                            <span class="badge bg-success">Activo</span>
                        {% else %}
                            <span class="badge bg-secondary">Inactivo</span>
                        {% endif %}
                    </td>
                    <td>
                        <a class="btn btn-info btn-sm" href="{{ path('app_product_show', {'id': product.id}) }}">Ver</a>
                        <a class="btn btn-warning btn-sm" href="{{ path('app_product_edit', {'id': product.id}) }}">Editar</a>
                        <form method="post" action="{{ path('app_product_delete', {'id': product.id}) }}" style="display: inline-block;" class="js-delete-form" data-swal-title="¿Eliminar producto?" data-swal-text="Esta acción no se puede deshacer. El producto '{{ product.nombre }}' será eliminado.">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
                            <button class="btn btn-danger btn-sm">Eliminar</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7">No hay productos registrados</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <a class="btn btn-primary" href="{{ path('app_product_new') }}">Crear nuevo producto</a>
    {% endset %}

    {% include 'partials/_card.html.twig' with {
        title: 'Listado de Productos',
        content: cardBody,
        color: 'light'
    } %}
{% endblock %}
