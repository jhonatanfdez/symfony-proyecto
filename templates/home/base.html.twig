<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Forzar recarga completa del head cuando se visita esta página con Turbo -->
		<meta name="turbo-visit-control" content="reload">
		<title>
			{% block title %}Panel de Control
			{% endblock %}
		</title>





		{% block stylesheets %}
			<!-- Bootstrap CSS -->
			<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" data-turbo-track="reload">
			<style data-turbo-track="reload">
				* {
					margin: 0;
					padding: 0;
					box-sizing: border-box;
				}

				html,
				body {
					margin: 0;
					padding: 0;
					font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
					overflow-x: hidden;
					height: 100%;
				}

				.header-title {
					background: #0d6efd;
					color: white;
					padding: 1.2rem;
					text-align: center;
					font-size: 1.5rem;
					font-weight: bold;
					width: 100%;
				}

				.horizontal-menu {
					background: #f8f9fa;
					border-bottom: 2px solid #dee2e6;
					width: 100%;
					padding: 0;
				}

				.horizontal-menu .nav {
					padding: 0.5rem 1rem;
				}

			.layout-wrapper {
				display: flex;
				width: 100%;
				min-height: calc(100vh - 120px);
				padding-bottom: 60px;
			}				.sidebar {
					width: 250px;
					min-width: 250px;
					background: #f8f9fa;
					border-right: 2px solid #dee2e6;
					padding: 1rem;
					overflow-y: auto;
				}

				.sidebar .user-info {
					background: #e9ecef;
					padding: 1rem;
					margin-bottom: 1rem;
					border-radius: 0.375rem;
				}

				.sidebar .user-info p {
					margin: 0;
					font-size: 0.875rem;
				}

				.sidebar .nav-link {
					color: #212529;
					padding: 0.75rem 1rem;
					border-radius: 0.375rem;
					margin-bottom: 0.25rem;
					transition: all 0.2s;
				}

				.sidebar .nav-link:hover {
					background: #0d6efd;
					color: white;
				}

				.sidebar .nav-link.active {
					background: #0d6efd;
					color: white;
				}

				.main-content {
					flex: 1;
					padding: 2rem;
					background: #ffffff;
					width: 100%;
					overflow-x: hidden;
				}

				.main-content h1 {
					margin-bottom: 1.5rem;
				}

				@media(max-width: 992px) {
					.layout-wrapper {
						flex-direction: column;
					}

					.sidebar {
						width: 100%;
						min-width: 100%;
						border-right: none;
						border-bottom: 2px solid #dee2e6;
					}

					.main-content {
						padding: 1rem;
					}
				}

				@media(max-width: 576px) {
					.header-title {
						font-size: 1.25rem;
						padding: 1rem;
					}

					.horizontal-menu .nav {
						flex-direction: column;
					}

				.main-content {
					padding: 0.75rem;
				}
			}

			.footer {
				background: #f8f9fa;
				border-top: 2px solid #dee2e6;
				padding: 1rem;
				text-align: center;
				color: #6c757d;
				font-size: 0.875rem;
				position: fixed;
				bottom: 0;
				left: 0;
				right: 0;
				width: 100%;
				z-index: 1000;
			}
		</style>
	{% endblock %}		{% block javascripts %}

    {% block importmap %}{{ importmap('app') }}{% endblock %}
			<!-- Bootstrap JS -->
			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
		{% endblock %}
	</head>
	<body>
		<!-- Título principal -->
		<div class="header-title">
			PANEL DE CONTROL
		</div>

		<!-- Menú horizontal secundario -->
		<nav class="horizontal-menu">

			<ul class="nav nav-pills nav-fill">
				<li class="nav-item">
					<a class="nav-link active" aria-current="page" href="#">Active</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#">Link</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#">Link</a>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" aria-disabled="true">Disabled</a>
				</li>
			</ul>
		</nav>


		<!-- Contenedor principal con sidebar y contenido -->
		<div
			class="layout-wrapper">
			<!-- Menú lateral -->
			<aside
				class="sidebar">
				{# Ruta actual para marcar enlaces activos #}
				{% set current_route = app.request.attributes.get('_route') %}
				<!-- Información del usuario -->
				{% if app.user %}
					<div class="user-info">
						<p class="mb-1 text-muted">Bienvenido/a</p>
                        {% if app.user.name %}
                            <p class="fw-bold mb-2">{{ app.user.name }}</p>
                        {% else %}
                            <p class="fw-bold mb-2">{{ app.user.userIdentifier }}</p>
                        {% endif %}
						<a href="{{ path('app_logout') }}" class="btn btn-primary btn-sm w-100">Cerrar sesión</a>
					</div>
				{% endif %}

				<!-- Menú de navegación -->
				<ul class="nav flex-column">
					<li class="nav-item text-uppercase text-muted small" style="pointer-events: none;">Usuarios</li>
					<li class="nav-item">
						<a class="nav-link {{ current_route == 'app_home' ? 'active' : '' }}" href="{{ path('app_home') }}">Inicio</a>
					</li>



                    <li class="nav-item">
						{# Perfil (show, edit) #}
						<a class="nav-link {{ current_route starts with 'app_profile_' ? 'active' : '' }}" href="{{ path('app_profile_show') }}">Mi perfil</a>
					</li>




					{% if is_granted('ROLE_ADMIN') %}
					<li class="nav-item text-uppercase text-muted small" style="pointer-events: none;">Administrativa</li>

					<li class="nav-item">
						{# Cualquier ruta que empiece por app_user_ (index, new, show, edit) #}
						<a class="nav-link {{ current_route starts with 'app_user_' ? 'active' : '' }}" href="{{ path('app_user_index') }}">Usuarios</a>
					</li>

					<li class="nav-item">
						<a class="nav-link {{ current_route == 'app_prueba' ? 'active' : '' }}" href="{{ path('app_prueba') }}">Prueba</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="#">Reportes</a>
					</li>
					{% endif %}
				</ul>
			</aside>

		<!-- Contenido principal -->
		<main class="main-content">
			<!-- Mensajes Flash -->
			{% for label, messages in app.flashes %}
				{% for message in messages %}
					{% if label == 'success' %}
						<div class="alert alert-success alert-dismissible fade show" role="alert">
							<strong>✓ Éxito:</strong> {{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					{% elseif label == 'error' %}
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<strong>✗ Error:</strong> {{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					{% elseif label == 'warning' %}
						<div class="alert alert-warning alert-dismissible fade show" role="alert">
							<strong>⚠ Advertencia:</strong> {{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					{% elseif label == 'info' %}
						<div class="alert alert-info alert-dismissible fade show" role="alert">
							<strong>ℹ Info:</strong> {{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
						</div>
					{% endif %}
				{% endfor %}
			{% endfor %}

			{% block content %}
				{% if template_path is defined %}
					{{ include(template_path) }}
				{% endif %}
			{% endblock %}
		</main>
		</div>

		<!-- Footer -->
		<footer class="footer">
			<p class="mb-0">Creado por Jhonatan Fernandez © {{ "now"|date("Y") }}</p>
		</footer>
	</body>
</html>
